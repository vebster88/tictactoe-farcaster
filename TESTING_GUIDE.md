# Локальное тестирование PvP игры

## Быстрый старт

1. **Установка зависимостей (если нужно):**
   ```bash
   npm install
   ```

2. **Запуск dev сервера:**
   
   Для локальной разработки нужно запустить два сервера:
   
   **Вариант 1 (рекомендуется):** Запустите в двух отдельных терминалах:
   
   Терминал 1 (API сервер):
   ```bash
   npm run dev:api
   ```
   
   Терминал 2 (Vite dev server):
   ```bash
   npm run dev
   ```
   
   **Вариант 2:** Используйте Vercel CLI (если установлен):
   ```bash
   vercel dev
   ```
   
   Приложение будет доступно по адресу: `http://localhost:5173`
   
   **Важно:** API сервер должен быть запущен на порту 3001 для корректной работы API endpoints.

## Тестирование PvP функциональности

### 0. Мобильные устройства

**Важно:** На мобильных устройствах авторизация работает только через Farcaster Mini App (Warpcast).

- ✅ **В Warpcast Mini App:** Авторизация происходит автоматически при открытии игры
- ❌ **В обычном мобильном браузере:** Авторизация через кошелек недоступна
- ✅ **На компьютере:** Работает авторизация через кошелек (MetaMask и т.д.)

**Если вы видите ошибку "Кошелёк не найден" на мобильном:**
1. Откройте приложение Warpcast
2. Найдите игру в разделе Mini Apps
3. Авторизация произойдет автоматически

### 1. Тестирование без KV (Fallback режим)

Приложение автоматически использует in-memory хранилище, если Vercel KV не настроен. Это идеально для локального тестирования.

**Что проверить:**

#### ✅ Создание матча
1. Откройте `http://localhost:5173`
2. Войдите через Farcaster (или используйте кошелек)
3. Выберите режим **"PvP — Farcaster"** в настройках
4. Нажмите кнопку **"Invite Player"** (или аналогичную)
5. Проверьте, что матч создан (должно появиться уведомление)

#### ✅ Просмотр списка матчей
1. Нажмите кнопку **"Matches"** (или иконку списка)
2. Проверьте, что ваш созданный матч отображается
3. Статус должен быть **"Pending"** или **"Waiting for opponent"**

#### ✅ Принятие матча (симуляция)
Для тестирования принятия матча нужно:
- Открыть приложение в двух браузерах/вкладках
- Использовать разные Farcaster аккаунты (или моки)
- Или использовать Farcaster Dev Tools для создания второго игрока

#### ✅ Отправка хода
1. После принятия матча (или в активном матче)
2. Нажмите на любую пустую ячейку на доске
3. Проверьте:
   - ✅ Кнопка блокируется на время отправки
   - ✅ Ход отправляется через API
   - ✅ Доска обновляется
   - ✅ Появляется уведомление о результате (если игра окончена)

#### ✅ Таймер
1. В активном матче должен отображаться таймер
2. Таймер показывает оставшееся время до конца хода (24 часа)
3. Таймер обновляется каждую секунду
4. При истечении времени показывается "Expired"

#### ✅ Синхронизация
1. Откройте матч в двух вкладках
2. Сделайте ход в одной вкладке
3. Вторая вкладка должна автоматически обновиться через 5 секунд
4. Должно появиться уведомление "Opponent made a move!"

### 2. Тестирование с моками/демо данными

Если нет доступа к Farcaster:

1. Приложение может работать в mock режиме
2. Проверьте консоль браузера на наличие ошибок
3. В fallback режиме все данные хранятся в памяти

### 3. Проверка API endpoints

Можно протестировать API напрямую:

```bash
# Создать матч
curl -X POST http://localhost:5173/api/matches/create \
  -H "Content-Type: application/json" \
  -d '{
    "matchId": "test-match-123",
    "player1Fid": 12345,
    "rules": {}
  }'

# Получить матч
curl "http://localhost:5173/api/matches/get?matchId=test-match-123"

# Список матчей игрока
curl "http://localhost:5173/api/matches/list?fid=12345"
```

## Проверка функций

### ✅ Toast уведомления
- Должны появляться при важных событиях
- Автоматически исчезают через 3 секунды
- Разные цвета для разных типов (success, error, warning, info)

### ✅ Индикаторы загрузки
- Кнопка блокируется при отправке хода
- Прозрачность уменьшается до 0.5
- Восстанавливается после ответа API

### ✅ Автозагрузка активного матча
1. Создайте матч
2. Примите его (или оставьте pending)
3. Обновите страницу
4. Должен автоматически загрузиться активный матч

### ✅ Обработка ошибок
1. Попробуйте сделать ход не в свою очередь → должно быть предупреждение
2. Попробуйте сделать ход в занятую ячейку → должна быть ошибка
3. Отключите интернет и попробуйте создать матч → должна быть ошибка

## Debugging

### Открыть DevTools
- `F12` или `Ctrl+Shift+I` (Windows/Linux)
- `Cmd+Option+I` (Mac)

### Проверить консоль
- Ошибки API будут в консоли
- Логи синхронизации (если включены)
- Информация о состоянии матча

### Проверить Network
- Во вкладке Network можно увидеть все API запросы
- Проверить статусы ответов (200, 400, 500)
- Посмотреть содержимое ответов

### Проверить LocalStorage
- `fc_session` - данные сессии Farcaster
- `language` - текущий язык
- Другие настройки приложения

## Известные ограничения локального тестирования

1. **Без KV**: Данные не сохраняются между перезапусками сервера
2. **Без Farcaster**: Некоторые функции требуют реального подключения
3. **Без двух аккаунтов**: Полное тестирование PvP требует двух игроков

## Следующие шаги

После локального тестирования:
1. Деплой на Vercel
2. Настройка Vercel KV
3. Тестирование в реальной Farcaster Mini App среде

